{"version":3,"file":"index.js","sources":["../src/lib/fns.js","../src/lib/dom.js","../src/index.js"],"sourcesContent":["// 类型判断：函数\r\nexport function isFunction(target) {\r\n  return typeof target === 'function'\r\n}\r\n\r\n// 类型判断：字符串\r\nexport function isString(target) {\r\n  return typeof target === 'string'\r\n}\r\n\r\n// 类型判断：Node 节点\r\nexport function isNode(target) {\r\n  return target instanceof Node\r\n}\r\n\r\n// 类型判断：Element 元素\r\nexport function isElement(target) {\r\n  return target instanceof Element\r\n}\r\n\r\n// 类型判断：MutationObserver 实例\r\nexport function isMO(target) {\r\n  return target instanceof MutationObserver\r\n}","import * as fns from './fns.js'\r\n\r\nclass element {\r\n  \r\n  constructor(target) {\r\n    if (target instanceof element) {\r\n      this.el = target.el\r\n    }\r\n    else if (fns.isString(target)) {\r\n      this.el = document.querySelector(target)\r\n    }\r\n    else if (fns.isNode(target) || fns.isElement(target)) {\r\n      this.el = target\r\n    }\r\n    if (!this.el) {\r\n      throw new Error('无效的监听对象！')\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 绑定数据\r\n   * @param {any} key 键\r\n   * @param {any} value 值\r\n   */\r\n  data(key, value = undefined) {\r\n    let dataSource = this.el.dataSource\r\n    if (!dataSource) {\r\n      dataSource = new Map()\r\n      this.el.dataSource = dataSource\r\n    }\r\n    if (value !== undefined) {\r\n      dataSource.set(key, value)\r\n      return this\r\n    }\r\n    return dataSource.get(key)\r\n  }\r\n}\r\n\r\nexport default function selector(target) {\r\n  return new element(target)\r\n}","import * as fns from './lib/fns.js'\r\nimport selector from './lib/dom.js'\r\n\r\n// 缓存器的键名\r\nconst observerKey = 'm-observer'\r\n\r\n// 初始化缓存器\r\nfunction initData(el) {\r\n  let mo = el.data(observerKey)\r\n  // 初始化\r\n  if (!mo) {\r\n    mo = new Map()\r\n    el.data(observerKey, mo)\r\n  }\r\n  return mo\r\n}\r\n\r\n// 保存数据\r\nfunction setData(el, callback, data) {\r\n  let da = initData(el)\r\n  let old = da.get(callback)\r\n  if (old && old.observer) {\r\n    let list = old.observer.takeRecords()\r\n    old.callback(list, old.observer)\r\n    old.observer.disconnect()\r\n  }\r\n  da.set(callback, data)\r\n}\r\n\r\n\r\n// 获取数据\r\nfunction getData(el, callback, clean = false) {\r\n  let data = initData(el)\r\n  let temp = data.get(callback)\r\n  // 清理数据\r\n  if (clean) {\r\n    data.delete(callback)\r\n  }\r\n  return temp || {}\r\n}\r\n\r\n/**\n * childList，attributes 或者 characterData 三个属性之中，至少有一个必须为 true，否则会抛出 TypeError 异常\n * \n * @param {Element|Node|String} target - 被监听的节点  \n * @param {Function} callback - 当观察到变动时执行的回调函数\n * @param {Object} config - MutationObserverInit字典配置项\r\n * @param {Boolean} isRecordList - 当为 true 时，回调函数第一个参数为 mutationRecordList，当为 false 时，回调函数第一个参数为 mutationRecord\n */\r\nexport function observe(target, callback, config, isRecordList = false) {\r\n  let el = selector(target)\r\n  if (!fns.isFunction(callback)) {\r\n    throw new Error('无效的观察回到函数！')\r\n  }\r\n  let fn = isRecordList ? callback : function(mutationsList, ob) {\r\n    for(let mutationRecord of mutationsList) {\r\n      callback(mutationRecord, ob)\r\n    }\r\n  }\r\n  let observer = new MutationObserver(fn)\r\n  observer.observe(el.el, config)\r\n  setData(el, callback, { config, fn, observer })\r\n}\r\n\r\n/**\n * MutationObserverInit 字典配置项（除 attributeFilter 外）都被设置为 true\n * \n * @param {Element|Node|String} target - 被监听的节点  \n * @param {Function} callback - 当观察到变动时执行的回调函数\n * @param {Array} config - MutationObserverInit.attributeFilter 配置项\r\n * @param {Boolean} isRecordList - 当为 true 时，回调函数第一个参数为 mutationRecordList，当为 false 时，回调函数第一个参数为 mutationRecord\n */\r\nexport function observeAll(target, callback, filter = undefined, isRecordList = false) {\r\n  let config = {\r\n    subtree: true,\r\n    childList: true,\r\n    attributes: true,\r\n    attributeOldValue: true,\r\n    characterData: true,\r\n    characterDataOldValue: true,\r\n  }\r\n  if (Array.isArray(filter)) {\r\n    config.attributeFilter = filter\r\n  }\r\n  observe(target, callback, config, isRecordList)\r\n}\r\n\r\n/**\n * 监听元素的属性值变更\n * \n * @param {Element|Node|String} target - 被监听的节点  \n * @param {Function} callback - 当观察到变动时执行的回调函数\r\n * @param {Boolean} subtree - 是否观察子节点\r\n * @param {Boolean} isRecordList - 当为 true 时，回调函数第一个参数为 mutationRecordList，当为 false 时，回调函数第一个参数为 mutationRecord\n */\r\nexport function attribute(target, callback, subtree = false, isRecordList = false) {\r\n  let config = {\r\n    subtree: !!subtree,\r\n    attributes: true,\r\n    attributeOldValue: true\r\n  }\r\n  observe(target, callback, config, isRecordList)\r\n}\r\n\r\n/**\n * 监听元素的特定属性名称\n * \n * @param {Element|Node|String} target - 被监听的节点\n * @param {Function} callback - 当观察到变动时执行的回调函数\n * @param {Array} filter - MutationObserverInit.attributeFilter 配置项\r\n * @param {Boolean} subtree - 是否观察子节点\r\n * @param {Boolean} isRecordList - 当为 true 时，回调函数第一个参数为 mutationRecordList，当为 false 时，回调函数第一个参数为 mutationRecord\n */\nexport function attributeFilter(target, callback, filter, subtree = false, isRecordList = false) {\n  let config = {\r\n    subtree: !!subtree,\n    attributes: true,\n    attributeFilter: filter,\n    attributeOldValue: true\n  }\n  observe(target, callback, config, isRecordList)\n}\r\n\r\n/**\n * 监视目标节点的子节点的添加或删除\n * \n * @param {Element|Node|String} target - 被监听的节点 \n * @param {Function} callback - 当观察到变动时执行的回调函数\r\n * @param {Boolean} subtree - 是否观察子节点\r\n * @param {Boolean} isRecordList - 当为 true 时，回调函数第一个参数为 mutationRecordList，当为 false 时，回调函数第一个参数为 mutationRecord\n */\nexport function childList(target, callback, subtree = false, isRecordList = false) {\n  let config = {\r\n    subtree: !!subtree,\r\n    childList: true,\r\n  }\r\n  observe(target, callback, config, isRecordList)\n}\r\n\r\n/**\n * 监视指定目标节点或子节点树中节点所包含的字符数据的变化\n * \n * @param {Element|Node|String} target - 被监听的节点\n * @param {Function} callback - 当观察到变动时执行的回调函数\r\n * @param {Boolean} isRecordList - 当为 true 时，回调函数第一个参数为 mutationRecordList，当为 false 时，回调函数第一个参数为 mutationRecord\n */\nexport function character(target, callback, isRecordList = false) {\n  let config = {\n    subtree: true,\n    characterData: true,\n    characterDataOldValue: true,\n  }\n  observe(target, callback, config, isRecordList)\n}\r\n\r\n/**\n * 告诉观察者停止观察变动，返回还未处理的通知\n * \n * @param {Element|Node|String} target - 被监听的节点 \n * @param {Function} callback - 当观察到变动时执行的回调函数\n */\r\nexport function disconnect(target, callback) {\r\n  let el = selector(target)\r\n  let { observer, fn } = getData(el, callback)\r\n  if (fns.isMO(observer)) {\r\n    let list = observer.takeRecords()\r\n    fn(list, observer)\r\n    observer.disconnect()\r\n  }\r\n}\r\n\r\n/**\n * 告诉观察者重新开始观察行为\n * \n * @param {Element|Node|String} target - 被监听的节点 \n * @param {Function} callback - 当观察到变动时执行的回调函数\n */\r\nexport function reconnect(target, callback) {\r\n  let el = selector(target)\r\n  let { observer, config } = getData(el, callback)\r\n  if (!fns.isMO(observer)) {\r\n    throw new Error('该监听器不存在（未定义或已被移除）！')\r\n  }\r\n  observer.observe(el.el, config)\r\n}\r\n\r\n/**\n * 移除观察者，返回还未处理的通知\n * \n * @param {Element|Node|String} target - 被监听的节点 \n * @param {Function} callback - 当观察到变动时执行的回调函数\n */\r\nexport function remove(target, callback) {\r\n  let el = selector(target)\r\n  let { observer, fn } = getData(el, callback, true)\r\n  if (fns.isMO(observer)) {\r\n    let list = observer.takeRecords()\r\n    fn(list, observer)\r\n    observer.disconnect()\r\n  }\r\n}"],"names":["isFunction","target","isString","isNode","Node","isElement","Element","isMO","MutationObserver","element","constructor","el","fns","document","querySelector","Error","data","key","value","undefined","dataSource","Map","set","get","selector","observerKey","initData","mo","setData","callback","da","old","observer","list","takeRecords","disconnect","getData","clean","temp","delete","observe","config","isRecordList","fn","mutationsList","ob","mutationRecord","observeAll","filter","subtree","childList","attributes","attributeOldValue","characterData","characterDataOldValue","Array","isArray","attributeFilter","attribute","character","reconnect","remove"],"mappings":"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"}